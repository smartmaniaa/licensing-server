<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Controle - SmartManiaa</title>
  <style>
    /* Estilos completos da página */
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; margin:2em; background:#f4f6f8; color:#333;}
    h1 { color: #2c3e50; }
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 1em;}
    .header-buttons { display: flex; gap: 1em; }
    .btn { background: #3498db; color: #fff; padding: 10px 18px; border: none; border-radius: 5px; text-decoration: none; font-weight: 500; font-size: 15px; }
    .btn-secondary { background-color: #7f8c8d; } /* Cor para o botão de exportar */
    table { width: 100%; border-collapse: collapse; margin-top: 1em; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;}
    th { background-color: #3498db; color: white;}
    tr:hover { background-color: #e8f4fd;}
    a { color: #3498db; text-decoration: none;}
    a:hover { text-decoration: underline;}
    .status-ativo { color: #27ae60; font-weight: bold; }
    .status-trial { color: #2980b9; font-weight: bold; }
    .status-inativo { color: #7f8c8d; }
    .email-alert {
      color: #c0392b;
      font-weight: bold;
      font-size: 1.2em;
      margin-left: 8px;
      text-decoration: none;
      cursor: help;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Painel de Controle SmartManiaa</h1>
    <div class="header-buttons">
      <a href="/admin/products" class="btn">Gerenciar Produtos</a>
      <a href="/admin/new" class="btn">Nova Licença</a>
      <a href="/admin/families" class="btn">Centro de Controle</a>
      <a href="/admin/trials" class="btn">Tentativas de Trial</a>
      <a href="/admin/licenses/export.csv" class="btn btn-secondary">Exportar CSV</a>
    </div>
  </div>

  <p>Abaixo está a lista de todas as licenças (chaveiros) criadas. Clique em uma chave para ver os detalhes e os direitos de uso associados.</p>

  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Chave de Licença</th>
        <th>Status</th>
        <th>Origem (Ativas)</th>
        <th>Data de Criação</th>
      </tr>
    </thead>
    <tbody>
      <% if @licenses.num_tuples.zero? %>
        <tr>
          <td colspan="5" style="text-align: center;">Nenhuma licença encontrada.</td>
        </tr>
      <% else %>
        <% @licenses.each do |license| %>
          <tr>
            <td>
              <%= license['email'] %>
              <% if license['email_status'] != 'ok' %>
                <span class="email-alert" title="Status do E-mail: <%= license['email_status'].upcase %>">!</span>
              <% end %>
            </td>
            <td><a href="/admin/license/<%= license['id'] %>"><code><%= license['license_key'] %></code></a></td>
            <td>
              <span class="status-<%= license['summary_status'].downcase %>">
                <%= license['summary_status'] %>
              </span>
            </td>
            <td>
              <%= license['summary_origins'] %>
            </td>
            <td><%= Time.parse(license['created_at']).strftime('%d/%m/%Y %H:%M') %></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</body>
</html>