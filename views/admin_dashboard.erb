<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel de Controle - SmartManiaa</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; margin:2em; background:#f4f6f8; color:#333;}
    h1 { color: #2c3e50; }
    .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 1em;}
    .header-buttons { display: flex; gap: 1em; }
    .btn {
      background: #3498db;
      color: #fff;
      padding: 10px 18px;
      border: none;
      border-radius: 5px;
      text-decoration: none;
      font-weight: 500;
      font-size: 15px;
      margin-right: 0px;
      display: inline-block;
      transition: background 0.17s, box-shadow 0.16s;
      box-shadow: 0 2px 7px rgba(0,0,0,0.04);
      cursor: pointer;
      letter-spacing: 0.03em;
    }
    .btn:last-child { margin-right: 0; }
    .btn:hover { background: #2174a8; }
    .search-form { margin: 2em 0; display: flex; gap: 1em; align-items: center;}
    .search-form input[type="search"], .search-form select { padding: 10px; border: 1px solid #ddd; border-radius: 5px;}
    .search-form input[type="search"] { width: 300px; }
    .search-form button { padding: 10px 15px; border: none; background-color: #3498db; color: white; border-radius: 5px; cursor: pointer; }
    .search-form button:hover { background: #2174a8;}
    table { width: 100%; border-collapse: collapse; margin-top: 1em; background-color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);}
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd;}
    th { background-color: #3498db; color: white;}
    tr:nth-child(even) { background-color: #f2f2f2;}
    tr:hover { background-color: #e8f4fd;}
    code { background-color: #eee; padding: 2px 4px; border-radius: 4px;}
    a { color: #3498db; text-decoration: none;}
    a:hover { text-decoration: underline;}
    .actions form { display: inline;}
    .actions button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.17s;
    }
    .actions button:hover { background: #2174a8; }
  </style>
</head>
<body>
  <div class="header">
    <h1>Painel de Controle SmartManiaa</h1>
    <div class="header-buttons">
      <a href="/admin/duplicates" class="btn">Ver Assinaturas Duplicadas</a>
      <a href="/admin/trials" class="btn">Ver Tentativas de Trial</a>
      <a href="/admin/products" class="btn">Gerenciar Produtos</a>
      <a href="/admin/new" class="btn">Criar Nova Licença</a>
    </div>
  </div>
  <div class="search-form">
    <form action="/admin" method="get">
      <input type="search" name="q" placeholder="Buscar por email, chave ou MAC..." value="<%= params['q'] %>">
      <select name="origin" onchange="this.form.submit()">
        <option value="">Todas as Origens</option>
        <% @origins.each do |origin| %>
          <option value="<%= origin %>" <%= 'selected' if params['origin'] == origin %>><%= origin.capitalize %></option>
        <% end %>
      </select>
      <button type="submit">Buscar</button>
      <% if (params['q'] && !params['q'].empty?) || (params['origin'] && !params['origin'].empty?) %>
        <a href="/admin" style="margin-left: 1em;">Limpar filtros</a>
      <% end %>
    </form>
  </div>
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Chave de Licença</th>
        <th>Status</th>
        <th>Origem</th>
        <th>Data de Criação</th>
        <th style="width: 120px;">Ações</th>
      </tr>
    </thead>
    <tbody>
      <% if @licenses.num_tuples.zero? %>
        <tr>
          <td colspan="6" style="text-align: center;">Nenhuma licença encontrada.</td>
        </tr>
      <% else %>
        <% @licenses.each do |license| %>
          <tr>
            <td><%= license['email'] %></td>
            <td><a href="/admin/license/<%= license['id'] %>"><code><%= license['license_key'] %></code></a></td>
            <td><%= license['status'] %></td>
            <td><%= license['origin'] %></td>
            <td><%= Time.parse(license['created_at']).strftime('%d/%m/%Y %H:%M') %></td>
            <td class="actions">
              <form action="/admin/license/<%= license['id'] %>/delete" method="post" onsubmit="return confirm('Tem certeza que deseja EXCLUIR esta licença permanentemente?');">
                <button type="submit">Excluir</button>
              </form>
            </td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</body>
</html>
