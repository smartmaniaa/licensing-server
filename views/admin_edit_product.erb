<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Editar Produto - SmartManiaa</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 2em; background-color: #f4f6f8; color: #333; }
    .container { max-width: 800px; margin: 0 auto; background-color: #fff; padding: 2em; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 8px; }
    h1, h2, h4 { color: #2c3e50; }
    h1 { border-bottom: 2px solid #3498db; padding-bottom: 10px; }
    h2, h4 { border-bottom: 1px solid #ccc; padding-bottom: 8px; margin-top: 2em;}
    .form-group { margin-bottom: 1.5em; }
    label { display: block; margin-bottom: 0.5em; font-weight: bold; }
    input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    input[readonly] { background-color: #e9ecef; cursor: not-allowed; }
    .checkbox-group { display: flex; flex-direction: column; gap: 8px; }
    .checkbox-group label { font-weight: normal; }
    button { background-color: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
    button:hover { opacity: 0.9; }
    .back-link { display: inline-block; margin-bottom: 2em; color: #3498db; text-decoration: none; }
    .back-link:hover { text-decoration: underline; }
    .error-box { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; padding: 1em; margin-bottom: 1.5em; border-radius: 5px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="/admin/products" class="back-link">&larr; Voltar para a lista de produtos</a>
    <h1>Editar Produto: <%= @product['name'] %></h1>

    <% if @error %>
      <div class="error-box"><%= @error %></div>
    <% end %>

    <form action="/admin/product/<%= @product['sku'] %>" method="post">
      <h2>Detalhes do Produto Interno</h2>
      <div class="form-group">
        <label for="sku">SKU do Produto (ID Interno - não pode ser alterado)</label>
        <input type="text" id="sku" name="sku" value="<%= @product['sku'] %>" readonly>
      </div>
      <div class="form-group">
        <label for="name">Nome do Produto</label>
        <input type="text" id="name" name="name" value="<%= @product['name'] %>" required>
      </div>
      <div class="form-group">
        <label for="family">Família do Produto</label>
        <input type="text" id="family" name="family" value="<%= @product['family'] %>" required>
      </div>
      <div class="form-group">
        <label for="latest_version">Última Versão</label>
        <input type="text" id="latest_version" name="latest_version" value="<%= @product['latest_version'] %>">
      </div>

      <div class="form-group">
  <label for="download_link">Link de Download do Produto</label>
  <input type="text" id="download_link" name="download_link" value="<%= @product['download_link'] %>">
  <p class="help-text">Link direto para o instalador ou página de download. Variável de e-mail: <code>{{product_download_link}}</code></p>
</div>

      <h4>Informações da Plataforma (Stripe)</h4>
      <div class="form-group">
        <label for="platform_id">ID de Preço do Stripe</label>
        <input type="text" id="platform_id" name="platform_id" value="<%= @platform_product['platform_id'] %>">
      </div>
      <div class="form-group">
        <label for="purchase_link">Link de Compra</label>
        <input type="text" id="purchase_link" name="purchase_link" value="<%= @platform_product['purchase_link'] %>">
      </div>

      <h2>Componentes da Suite (se aplicável)</h2>
      <div class="form-group">
        <p>Selecione os produtos que fazem parte deste pacote/suite.</p>
        <div class="checkbox-group">
          <% @all_other_products.each do |component| %>
            <% is_checked = @suite_components.any? { |sc| sc['component_product_id'] == component['sku'] } %>
            <div>
              <input type="checkbox" name="component_skus[]" value="<%= component['sku'] %>" id="component_<%= component['sku'] %>" <%= 'checked' if is_checked %>>
              <label for="component_<%= component['sku'] %>"><%= component['name'] %></label>
            </div>
          <% end %>
        </div>
      </div>

      <button type="submit">Salvar Alterações</button>
    </form>
  </div>
</body>
</html>